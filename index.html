<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test</title>
    <link rel="stylesheet" href="./css/basis.css">
    <link rel="stylesheet" href="./components/index.css">
    <script src="./components/index.js"></script>
</head>

<body>
    <!-- form表单 -->
    <form class="form" style="width: 400px;" method="post" onsubmit="return form()">
        <div class="input">
            <div class="label">账号</div>
            <input id="uname" type="text" placeholder="请输入账号">
        </div>
        <div class="input">
            <div class="label">密码</div>
            <input id="pword" type="password" placeholder="请输入密码">
        </div>
        <div class="input input-code">
            <div class="label">验证码</div>
            <input id="code" type="text" placeholder="请输入验证码">
            <div class="code">
                <img onclick="makeCode()" id="code-img">
            </div>
        </div>
        <button class="button" type="submit">登录</button>
    </form>

</body>
<script>
    let code_info = {}
    function makeCode() {
        let canvas = document.createElement("canvas")
        canvas.width = 100
        canvas.height = 36
        var ctx = canvas.getContext("2d");
        ctx.fillStyle = color(Math.random())
        ctx.fillRect(0, 0, 100, 36);
        ctx.fillStyle = color();
        ctx.font = "18px 微软雅黑"
        let num1 = Math.round(Math.random() * 98)
        let num2 = Math.round(Math.random() * 98)
        let utils = ['*', '+', '-']
        let util = utils[Math.round(Math.random() * 2)]
        ctx.fillStyle = color();
        ctx.fillText(num1, 5, 27)
        ctx.fillStyle = color();
        ctx.fillText(util, 25, 27)
        ctx.fillStyle = color();
        ctx.fillText(num2, 35, 27)
        ctx.fillStyle = color();
        ctx.fillText("=", 60, 27)
        ctx.fillStyle = color();
        ctx.fillText("?", 80, 27)
        ctx.strokeStyle  = color();
        ctx.lineWidth = Math.round(Math.random() * 2);
        ctx.moveTo(5, Math.round(Math.random() * 28) + 3);
        ctx.lineTo(95, Math.round(Math.random() * 28) + 3);
        ctx.stroke();
        function color(e) {
            return `rgba(${Math.round(Math.random() * 255)},${Math.round(Math.random() * 255)},${Math.round(Math.random() * 255)},${e || 1})`
        }
        document.getElementById("code-img").src = canvas.toDataURL('image/png')
        code_info = {
            num1: num1,
            num2: num2,
            util: util
        }
    }
    makeCode()
    // 获取 input 的值
    function getValue(e) {
        return document.getElementById(e).value
    }
    /* 表单验证 */
    function form() {
        let uname = getValue("uname")
        let pword = getValue("pword")
        let code = getValue("code")
        if (uname.length < 5) {
            // 弹窗提示
            $message({
                title: "账号至少五位数",
                type: "warning"
            })
        } else if (pword.length < 5) {
            // 弹窗提示
            $message({
                title: "密码至少五位数",
                type: "warning"
            })
        } else if (code.length < 1) {
            // 弹窗提示
            $message({
                title: "请输入验证码",
                type: "warning"
            })
        } else {
            function result(e) {
                if (e.util == '*') {
                    return e.num1 * e.num2
                } else if (e.util == '+') {
                    return e.num1 + e.num2
                } else if (e.util == '-') {
                    return e.num1 - e.num2
                } else {
                    return null
                }
            }
            if (code != result(code_info)) {
                $message({
                    title: "验证码错误",
                    type: "warning"
                })
            } else {
                $message({
                    title: "登陆成功",
                    type: "success"
                })
            }
        }
        return false
    }
</script>

<style>
</style>

</html>